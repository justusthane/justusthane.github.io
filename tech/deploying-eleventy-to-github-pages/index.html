<!DOCTYPE html>
<html style="scroll-behavior: smooth;" lang="en">
<head>
    <meta charset="utf-8" />
    <title>How To Deploy an Eleventy Site to Github Pages with a Custom Domain | justus.ws</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Home, home on the web, where the links and the hypertexts play">

    <link rel="shortcut icon" type="image/png" href="/images/daoi_round.png" />
    <link rel="canonical" href="https://justus.ws/tech/deploying-eleventy-to-github-pages/" />
    <link rel="stylesheet" href="/style/style.css" type="text/css">
    <link rel="stylesheet" href="/style/prism-cb.css" type="text/css">
    <link rel="stylesheet" href="/webfonts/badscript.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="/style/fontawesome-all.min.css" type="text/css">
    <link rel="webmention" href="https://webmention.io/justus.ws/webmention" />

</head>
<body id="top" class="color-auto ">
  <div id="toggle-color">
  </div>
  <div id="wrapper">
    <div id="titleContainer">
      <div id="avatar">
        <a href="/"><img alt="Avatar" src="/images/dadi-avatar.png" class="avatar"></a>
      </div>
      <div id="sitetitle">
        <div class="logo"><a href="/" class="u-url u-uid p-name" rel="me">justus<br>grunow</a></div> 
      </div>
    </div>
    <div id="tagline">home, home on the web<br />where the links and the hypertexts play
        <div id="elsewhere">
                      <a href="mailto:jg@justus.ws" rel="me" class="u-email" data-label="<strong>email</strong>&nbsp;| jg@justus.ws" aria-label="Email"><i class="far fa-envelope-open" aria-hidden="true"></i></a>
                                <a href="https://photos.justus.ws" rel="me" data-label="<strong>photos</strong>&nbsp;| smugmug" aria-label="Photography"><i class="fas fa-camera-retro" aria-hidden="true"></i></a>
                                          <a href="https://github.com/justusthane" rel="me" data-label="<strong>code</strong>&nbsp;| github" aria-label="Github"><i class="fab fa-github" aria-hidden="true"></i></a>
                                                  </div>
    </div>
    <div id="sidebar">
      

<details id="menuMobile">
  <summary>Menu</summary>
        <ul>
          <li><a href="/">home</a></li>
          
          <li>
            <a href="/craft/">craft</a>/sewing projects
          </li>
          
          <li>
            <a href="/tech/">tech</a> stuff
          </li>
          
          <li>
            <a href="/food/">food</a> &amp; kitchen
          </li>
          
          <li>
            <a href="/garden/">garden</a>ing
          </li>
          
          <li>
            <a href="/misc/">misc</a>
          </li>
          
          <li>
            <a href="/writings/">writings</a> &amp; musings
          </li>
          
          <li>
            <a href="/blog/">blog</a>
          </li>
          
          <li>
            <a href="/why/">why</a> does this site exist?
          </li>
          
          <li>
            <a href="/how/">how</a> does this site work?
          </li>
          
          <li>
            <a href="/links/">links</a> &amp; other things I like
          </li>
          
          <li>
            <a href="/now/">now</a>: what I&#39;m up to
          </li>
          
          <li>
            <a href="/todo/">todo</a> for this site
          </li>
          
        </ul>
</details>
        <div id="menuDesktop">
          <ul>
          <li><a href="/">home</a></li>
            
            <li>
              <a href="/craft/">craft</a>/sewing projects
            </li>
            
            <li>
              <a href="/tech/">tech</a> stuff
            </li>
            
            <li>
              <a href="/food/">food</a> &amp; kitchen
            </li>
            
            <li>
              <a href="/garden/">garden</a>ing
            </li>
            
            <li>
              <a href="/misc/">misc</a>
            </li>
            
            <li>
              <a href="/writings/">writings</a> &amp; musings
            </li>
            
            <li>
              <a href="/blog/">blog</a>
            </li>
            
            <li>
              <a href="/why/">why</a> does this site exist?
            </li>
            
            <li>
              <a href="/how/">how</a> does this site work?
            </li>
            
            <li>
              <a href="/links/">links</a> &amp; other things I like
            </li>
            
            <li>
              <a href="/now/">now</a>: what I&#39;m up to
            </li>
            
            <li>
              <a href="/todo/">todo</a> for this site
            </li>
            
          </ul>
        </div>

    </div>
    </header>

    <main id="content">
      


<a href="/tech"><i class="fas fa-arrow-circle-left"></i>&nbsp;tech</a>
  <h1>

  How To Deploy an Eleventy Site to Github Pages with a Custom Domain

  </h1>

<p class="publish-date">Published 2020-09-05</p>
<nav class="table-of-contents"><ol><li><a href="#intro-%26-prereqs">Intro &amp; Prereqs</a><ol><li><a href="#hosting-an-eleventy-site-on-github-pages-without-a-custom-domain">Hosting an Eleventy site on Github Pages without a custom domain</a></li></ol></li><li><a href="#instructions">Instructions</a><ol><li><a href="#get-eleventy-ready-for-github-pages">Get Eleventy ready for Github Pages</a></li><li><a href="#create-your-github-repo">Create your Github Repo</a></li><li><a href="#set-up-the-github-action">Set up the Github Action</a></li><li><a href="#set-up-your-dns-records">Set up your DNS records</a></li><li><a href="#configure-your-custom-domain">Configure your custom domain</a></li><li><a href="#done%E2%80%A6almost">Done…almost</a></li><li><a href="#adding-a-cname-file">Adding a CNAME file</a></li></ol></li><li><a href="#comments">Comments</a></li></ol></nav><h1 id="intro-%26-prereqs">Intro &amp; Prereqs</h1>
<p>Github Pages is an excellent way to host a site built with the <a href="https://11ty.dev">Eleventy</a> static-site generator—with just a little bit of work, you can have free hosting with a custom domain that automatically rebuilds your site with every <code>git push</code>.</p>
<p>This guide is adapted from <a href="https://dev.to/sophiabrandt/how-to-deploy-eleventy-to-github-pages-with-github-actions-0">this excellent guide</a> by <a href="https://www.sophiabrandt.com">Sophia Brandt</a> with some additions.</p>
<p>This guide assumes the following prerequisites:</p>
<ul>
<li>You already own a domain.</li>
<li>You already have a site built in Eleventy. If not, follow the <a href="https://www.11ty.dev/docs/getting-started/">Getting Started</a> guide at the Eleventy website.</li>
<li>You have a basic understanding of how to use Git and Github. If not, learn it! It’s probably not as hard as you expect, and it’s well worth your time. <a href="https://towardsdatascience.com/getting-started-with-git-and-github-6fcd0f2d4ac6?gi=fd38779a1e37">Here’s a beginner’s tutorial</a>.</li>
<li>You have git installed on your computer and have a local git repo set up for your Eleventy site.</li>
<li>You have a basic understanding of how to create DNS records.</li>
</ul>
<h2 id="hosting-an-eleventy-site-on-github-pages-without-a-custom-domain">Hosting an Eleventy site on Github Pages <em>without</em> a custom domain</h2>
<p>Although this guide assumes you want to use a custom domain, you can also certainly host an Eleventy site on Github Pages without one, using <code>&lt;your-github-username&gt;.github.io</code> instead. If that’s the case, ignore the “Set up your DNS records” section and everything after.</p>
<h1 id="instructions">Instructions</h1>
<h2 id="get-eleventy-ready-for-github-pages">Get Eleventy ready for Github Pages</h2>
<p>First, edit the <code>package.json</code> file in your Eleventy folder to include <strong>build</strong> and <strong>serve</strong> scripts by adding the highlighed lines as follows:</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"11ty-justus.ws"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span></span><br><mark class="highlight-line highlight-line-active">    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"eleventy --serve"</span><span class="token punctuation">,</span></mark><br><mark class="highlight-line highlight-line-active">    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"eleventy"</span></mark><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">...</span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Currently you probably build and serve Eleventy locally with the command <code>eleventy --serve</code>. The above allows you to do the same thing by using the command <code>npm run serve</code> (or <code>npm run build</code> to build the site without starting the webserver). You don’t need to use these commands if you don’t want to, but they are required by the Github Action.</p>
<h2 id="create-your-github-repo">Create your Github Repo</h2>
<p>Create a new repo on Github. The repo <strong>must</strong> be named “&lt;github-username&gt;.github.io”. For example, if your Github username is “janedoe”, your repo needs to be named “<a href="http://janedoe.github.io">janedoe.github.io</a>”.</p>
<p>If you already have an existing Github repo that you’re using with your Eleventy site, you can either rename it or create a new repo. We’ll be pushing your local repo up to it, so your commit history will be retained.</p>
<p>Once you have your repo set up on Github, add it as the origin to your local repo:</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># git remote add github &lt;url-of-your-github-repo></span><br><span class="token comment"># git push -u github master</span></code></pre>
<p><strong>Note:</strong> The <code>-u</code> flag sets Github as the default upstream origin for this branch, so from now on you can just run <code>git push</code> to push to Github.</p>
<h2 id="set-up-the-github-action">Set up the Github Action</h2>
<p>Create the file <code>.github/workflows/build.yml</code> in the root of your Eleventy site (you’ll have to create the <code>.github</code> and <code>workflows</code> directories) with the following contents:</p>
<pre class="language-yaml"><code class="language-yaml"><br><span class="token key atrule">name</span><span class="token punctuation">:</span> Build Eleventy<br><br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> master<br><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span><span class="token number">20.04</span><br><br>    <span class="token key atrule">strategy</span><span class="token punctuation">:</span><br>      <span class="token key atrule">matrix</span><span class="token punctuation">:</span><br>        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>12.x<span class="token punctuation">]</span><br><br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use Node.js $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span><br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span><br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies &amp; build<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>          npm ci<br>          npm run build</span><br><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> peaceiris/actions<span class="token punctuation">-</span>gh<span class="token punctuation">-</span>pages@v3<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">publish_dir</span><span class="token punctuation">:</span> ./_site<br>          <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span><br></code></pre>
<p>This Action calls on <a href="https://github.com/peaceiris/actions-gh-pages">this third-party action</a> by <a href="https://peaceiris.com/">Peace Iris</a> to actually do the deploy. Luckily we don’t need to understand exactly how it works, but basically it copies the static files from the <code>_site</code> directory where Eleventy outputs them to a new <code>gh-pages</code> branch where Github will serve them from.</p>
<p>Save it, commit it, and push it to Github:</p>
<pre class="language-shell"><code class="language-shell"><span class="token comment"># git add .</span><br><span class="token comment"># git commit -m 'Added Github Actions build file`</span><br><span class="token comment"># git push</span></code></pre>
<p>Now to get Github to build your site, make a change to any file, and again save it, commit it, and push it.</p>
<p><strong>If you aren’t using a custom domain, you’re done! Your site should be accessible now at <code>&lt;github-username&gt;.github.io</code>. Otherwise, read on!</strong></p>
<h2 id="set-up-your-dns-records">Set up your DNS records</h2>
<p>Create a CNAME record for <code>www.your-domain.com</code> pointing to <code>&lt;your-github-username&gt;.github.io</code>, and a CNAME, ANAME, or ALIAS (whatever your provider supports) at the root of your domain pointing to <code>&lt;your-github-username&gt;.github.io</code>.</p>
<p>If your DNS provider doesn’t support any of these alias records at the root of your domain you can also use A records pointing at Github’s UP addresses <a href="https://docs.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain">as indicated here</a>, but it’s better to use an alias if possible.</p>
<h2 id="configure-your-custom-domain">Configure your custom domain</h2>
<p>Open the <strong>Settings</strong> page for your repo on the Github website, and scroll down to the <strong>Github Pages</strong> section. Under <strong>Source</strong>, change the branch to <code>gh-pages</code>. Leave the folder set to <code>/ (root)</code>.</p>
<p>Set the <strong>Custom Domain</strong> to <code>www.your-domain.com</code> and save it.</p>
<h2 id="done%E2%80%A6almost">Done…almost</h2>
<p>If everything went correctly, your site should now be visible online. However, next time you push your site, you’ll notice that it has disappeared from the internet! When you visit <code>www.your-domain.com</code>, you’ll see the following error:</p>
<p><img src="404.png" alt="404 error"></p>
<p>Well that’s not good. If you go back to the Settings page for your Github repo, you’ll see that your custom domain info has been removed!</p>
<p><img src="custom-domain-missing.png" alt="No custom domain"></p>
<p>If you enter it back in, it will work again—until the next time you push your site. Obviously we don’t want to have to re-enter our domain every time we push our site!</p>
<p>It turns out the issue is that Github stores your domain info in a CNAME file in the root of the <code>gh-pages</code> branch, but every time we build our site, Eleventy deletes the file and thus our custom domain setting is lost.</p>
<h2 id="adding-a-cname-file">Adding a CNAME file</h2>
<p>The solution is to create a file called <code>CNAME</code> in the root of your Eleventy site with a single line containing your custom domain:</p>
<pre class="language-yaml"><code class="language-yaml">www.your<span class="token punctuation">-</span>domain.com</code></pre>
<p>Now we need to tell Eleventy to copy that file when building your site, because by default, it won’t.</p>
<p>Edit your <code>.eleventy.js</code> file and add the highlighted line:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eleventyConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token operator">...</span></span><br><mark class="highlight-line highlight-line-active">  eleventyConfig<span class="token punctuation">.</span><span class="token function">addPassthroughCopy</span><span class="token punctuation">(</span><span class="token string">"CNAME"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><span class="highlight-line">  <span class="token operator">...</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>(For more information on Passthrough File Copy, see the Eleventy <a href="https://www.11ty.dev/docs/copy/">documentation</a>.</p>
<p>Save it, commit it, push it, and your site should be back. Yay!</p>
<h1 id="comments">Comments</h1>
<p>Comments? Questions? Was this helpful? <a href="mailto:jg@justus.ws">Email me</a>!</p>

<a href="#wrapper"><i class="fas fa-arrow-circle-up"></i>&nbsp;top</a>

    </main>
    
    
  </div>

  <script src="/js/jquery-3.5.1.min.js"></script>
  <script src="/js/scripts.js"></script>

</body>
</html>
